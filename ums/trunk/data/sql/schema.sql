CREATE TABLE activity (id BIGINT AUTO_INCREMENT, name VARCHAR(255), type VARCHAR(255), resource_type VARCHAR(255), resource_uri_upload VARCHAR(255), resource_uri_external VARCHAR(255), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE activity_concept (activity_id BIGINT, concept_id BIGINT, bloom_evaluation DOUBLE, bloom_synthesis DOUBLE, bloom_analysis DOUBLE, bloom_application DOUBLE, bloom_understanding DOUBLE, bloom_knowledge DOUBLE, PRIMARY KEY(activity_id, concept_id)) ENGINE = INNODB;
CREATE TABLE activity_sub_activity (parent_id BIGINT, child_id BIGINT, PRIMARY KEY(parent_id, child_id)) ENGINE = INNODB;
CREATE TABLE domain_model (id BIGINT AUTO_INCREMENT, concept_name VARCHAR(255), lft INT, rgt INT, level SMALLINT, slug VARCHAR(255), UNIQUE INDEX sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE groups (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user (id BIGINT AUTO_INCREMENT, username VARCHAR(255) NOT NULL UNIQUE, email VARCHAR(255) UNIQUE, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user2_user_group (user_id BIGINT, group_id BIGINT, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE user_activity (user_id BIGINT, group_id BIGINT, activity_id BIGINT, progress BIGINT DEFAULT 0, PRIMARY KEY(user_id)) ENGINE = INNODB;
CREATE TABLE user_group (user_id BIGINT, group_id BIGINT, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE user_model (id BIGINT AUTO_INCREMENT, concept_id BIGINT, user_id BIGINT, bloom_evaluation DOUBLE, bloom_synthesis DOUBLE, bloom_analysis DOUBLE, bloom_application DOUBLE, bloom_understanding DOUBLE, bloom_knowledge DOUBLE, INDEX concept_id_idx (concept_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE activity_concept ADD FOREIGN KEY (concept_id) REFERENCES domain_model(id) ON DELETE CASCADE;
ALTER TABLE activity_concept ADD FOREIGN KEY (activity_id) REFERENCES activity(id) ON DELETE CASCADE;
ALTER TABLE activity_sub_activity ADD FOREIGN KEY (parent_id) REFERENCES activity(id);
ALTER TABLE user2_user_group ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_group ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_group ADD FOREIGN KEY (group_id) REFERENCES groups(id) ON DELETE CASCADE;
ALTER TABLE user_model ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_model ADD FOREIGN KEY (concept_id) REFERENCES domain_model(id) ON DELETE CASCADE;
