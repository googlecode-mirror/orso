CREATE TABLE activity (id BIGINT AUTO_INCREMENT, name VARCHAR(255), type VARCHAR(255), weight DOUBLE, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE activity_concept (activity_id BIGINT, concept_id BIGINT, weight BIGINT, PRIMARY KEY(activity_id, concept_id)) ENGINE = INNODB;
CREATE TABLE domain_model (id BIGINT AUTO_INCREMENT, concept_name VARCHAR(255), lft INT, rgt INT, level SMALLINT, slug VARCHAR(255), UNIQUE INDEX sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE groups (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user (id BIGINT AUTO_INCREMENT, username VARCHAR(255) NOT NULL UNIQUE, email VARCHAR(255) UNIQUE, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user2_user_group (user_id BIGINT, group_id BIGINT, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE user_group (user_id BIGINT, group_id BIGINT, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE user_model (id BIGINT AUTO_INCREMENT, concept_id BIGINT, user_id BIGINT, bloom_evaluation BIGINT, bloom_synthesis BIGINT, bloom_analysis BIGINT, bloom_application BIGINT, bloom_understanding BIGINT, bloom_knowledge BIGINT, INDEX concept_id_idx (concept_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE activity_concept ADD FOREIGN KEY (concept_id) REFERENCES domain_model(id) ON DELETE CASCADE;
ALTER TABLE activity_concept ADD FOREIGN KEY (activity_id) REFERENCES activity(id) ON DELETE CASCADE;
ALTER TABLE user2_user_group ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_group ADD FOREIGN KEY (user_id) REFERENCES user(id);
ALTER TABLE user_group ADD FOREIGN KEY (group_id) REFERENCES groups(id);
ALTER TABLE user_model ADD FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user_model ADD FOREIGN KEY (concept_id) REFERENCES domain_model(id) ON DELETE CASCADE;
